<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Little X and the Web of Life - Book 3</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
        }
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s infinite alternate;
        }
        @keyframes twinkle {
            0% { opacity: 0.3; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.2); }
        }
        @keyframes float-up {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-100px) scale(1.5); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        @keyframes guest-pop {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }
        h1 {
            text-align: center;
            font-size: 2.5em;
            text-shadow: 0 0 20px #00ff00;
            animation: glow 2s ease-in-out infinite alternate;
            margin-bottom: 10px;
        }
        @keyframes glow {
            from { text-shadow: 0 0 20px #00ff00; }
            to { text-shadow: 0 0 30px #00ff00, 0 0 40px #32CD32; }
        }
        .chapter {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #00ff00;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            line-height: 1.8;
        }
        .chapter h2 {
            color: #00ff00;
            margin-top: 0;
        }
        .chalkboard-container {
            background: rgba(0, 255, 0, 0.2);
            border: 3px dashed #00ff00;
            border-radius: 15px;
            padding: 20px;
            margin: 30px 0;
            text-align: center;
            position: relative;
        }
        .btn {
            background: linear-gradient(45deg, #00ff00, #32CD32);
            border: none;
            color: #000;
            font-weight: bold;
            padding: 12px 24px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 255, 0, 0.5);
        }
        .controls {
            margin-top: 15px;
        }
        .instruments {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        .story-text {
            font-size: 18px;
            margin: 20px 0;
        }
        .character-speech {
            background: rgba(0, 255, 0, 0.1);
            border-left: 4px solid #00ff00;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .guest-chat {
            background: rgba(138, 43, 226, 0.1);
            border-left: 4px solid #8a2be2;
            animation: guest-pop 1s ease-out;
        }
        .nav-buttons {
            text-align: center;
            margin: 30px 0;
        }
        
        /* ABACUS STYLES */
        .abacus-frame {
            background: linear-gradient(135deg, #8B4513, #D2691E);
            padding: 25px;
            border-radius: 15px;
            box-shadow: inset 0 4px 10px rgba(0,0,0,0.3);
            border: 4px solid #654321;
            margin: 20px auto;
            max-width: 500px;
        }
        .abacus-columns {
            display: flex;
            justify-content: space-around;
            gap: 20px;
        }
        .abacus-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 80px;
        }
        .column-label {
            background: rgba(255,255,255,0.9);
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9em;
            color: #764ba2;
            text-align: center;
            margin-bottom: 10px;
        }
        .heaven-section {
            height: 100px;
            width: 70px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 8px;
        }
        .earth-section {
            height: 180px;
            width: 70px;
            position: relative;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            justify-content: flex-start;
            padding-bottom: 8px;
            gap: 6px;
        }
        .divider-bar {
            width: 100%;
            height: 8px;
            background: linear-gradient(180deg, #FFD700, #FFA500);
            border: 2px solid #FF8C00;
            border-radius: 4px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.4);
            margin: 4px 0;
            z-index: 10;
            position: relative;
        }
        .rod {
            position: absolute;
            width: 6px;
            height: 100%;
            background: linear-gradient(90deg, #654321, #8B4513);
            left: 50%;
            transform: translateX(-50%);
            border-radius: 3px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.4);
            z-index: 0;
        }
        .bead {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.25s ease-out;
            box-shadow: 0 3px 8px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.1em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            user-select: none;
            position: relative;
            z-index: 5;
            border: 2px solid rgba(0,0,0,0.3);
        }
        .bead:hover {
            transform: scale(1.15);
            box-shadow: 0 5px 12px rgba(0,0,0,0.6);
        }
        .bead.heaven {
            background: radial-gradient(circle at 35% 35%, #FFD700, #FFA500, #FF8C00);
            width: 55px;
            height: 55px;
            font-size: 1.3em;
            position: absolute;
            top: 8px;
        }
        .bead.heaven.counted {
            top: 50px;
            background: radial-gradient(circle at 35% 35%, #32CD32, #228B22, #006400);
        }
        .bead.earth {
            background: radial-gradient(circle at 35% 35%, #FF6B6B, #EE5A6F, #C92A2A);
        }
        .bead.earth.counted {
            background: radial-gradient(circle at 35% 35%, #51CF66, #37B24D, #2F9E44);
        }
        .abacus-display {
            text-align: center;
            margin: 20px 0;
        }
        .abacus-total {
            font-size: 3em;
            color: #00ff00;
            font-weight: bold;
            text-shadow: 0 0 10px #00ff00;
        }
        .abacus-breakdown {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
            font-size: 1em;
        }
        .breakdown-item {
            background: rgba(0, 255, 0, 0.2);
            padding: 6px 12px;
            border-radius: 8px;
            border: 1px solid #00ff00;
        }
        
        @media (max-width: 600px) {
            h1 { font-size: 2em; }
            .chapter { padding: 20px; }
            .abacus-column { min-width: 60px; }
            .bead { width: 38px; height: 38px; }
            .bead.heaven { width: 48px; height: 48px; }
        }
    </style>
</head>
<body>
    <div id="stars-container"></div>
    
    <div class="container">
        <h1>üåç Little X and the Web of Life üåç</h1>
        <p style="text-align: center; font-size: 1.2em; color: #00ff00;">Book 3 of the Little X Adventures</p>
        
        <div class="chapter">
            <h2>Chapter 1: The Living Network</h2>
            
            <div class="story-text">
                <p>After the exciting moon base adventure in Book 2, Little X found something new glowing in Uncle Harold's workshop‚Äîa magnificent holographic display showing Earth from space, covered in shimmering green and blue threads of light connecting everything!</p>
                
                <div class="character-speech">
                    <strong>ARIA:</strong> "Welcome back, Little X! You've mastered rockets, music, and creative building. But now it's time to zoom out and see the BIGGEST picture of all!"
                </div>
                
                <div class="character-speech">
                    <strong>Little X:</strong> "Wow! What are all those glowing threads?"
                </div>
                
                <div class="character-speech">
                    <strong>ARIA:</strong> "That's the WEB OF LIFE! Science isn't just gears and buttons‚Äîit's how EVERYTHING connects. Those threads show how plants drink sunlight and make oxygen, bugs munch leaves, birds eat bugs, and we're all part of this incredible cosmic dance!"
                </div>
                
                <p>Raaarrr bounded into view, scales flickering bright green like a forest. "Raaarrr! I'm part of the web too! I chomp plants but help spread seeds with my mighty tail! Every creature has a job!"</p>
                
                <div class="character-speech">
                    <strong>Little X:</strong> "It's like a giant friendship bracelet made of stars and trees and animals!"
                </div>
                
                <p>Suddenly, the hologram zoomed in to show dark gray smog billowing from large factories. "See those sneaky smoky monsters?" ARIA pointed. "Big factories sometimes puff yucky stuff‚Äîheavy metals, pollution‚Äîinto air and water. They do it chasing shiny gold coins, not caring about fishies coughing or trees sneezing!"</p>
                
                <div class="character-speech">
                    <strong>Raaarrr:</strong> "Raaarrr! That's not fair to the web! Can't we stomp them?"
                </div>
                
                <div class="character-speech">
                    <strong>ARIA:</strong> "Here's where WISDOM shines! We don't just roar 'No factories ever!' That's rigid thinking that breaks when the world changes. Instead, we use REASON‚Äîthe real superhero! We think: 'How can we make cleaner machines? How can we fix this mess SMARTLY?' Ethics means caring for people AND planet with flexible solutions that grow and adapt. Hard rules snap like twigs, but smart ideas bend like willow trees in the wind!"
                </div>
                
                <div class="character-speech">
                    <strong>Raaarrr:</strong> "Raaarrr-YES! THINKING beats STOMPING! Let's be web heroes with our brains, not just claws!"
                </div>
            </div>
            
            <div class="chalkboard-container">
                <h3>üåç Build & Clean the Web of Life!</h3>
                <p>Draw lines connecting: Sun ‚Üí Plant ‚Üí Bug ‚Üí Bird ‚Üí Flower. Then activate Pollution Zap mode!</p>
                <canvas id="web-canvas" width="600" height="420" style="display: block; margin: 20px auto; cursor: crosshair; border-radius: 10px;"></canvas>
                <div id="web-message" style="margin-top: 15px; color: #00ff00; font-weight: bold;">Draw lines to connect the web! Start from the Sun ‚òÄÔ∏è</div>
                <div class="controls">
                    <button class="btn" onclick="clearWeb()">Clear Web</button>
                    <button class="btn" onclick="startCleanup()">üßπ Pollution Zap Mode!</button>
                    <button class="btn" onclick="checkWeb()">Check My Web!</button>
                </div>
            </div>
        </div>

        <!-- NEW ABACUS CHAPTER! -->
        <div class="chapter" id="chapter-abacus" style="display: none;">
            <h2>üßÆ Chapter: Counting the Web! üßÆ</h2>
            
            <div class="story-text">
                <p>After cleaning up the pollution, ARIA's hologram shimmered and transformed into something ancient and magical‚Äîa wooden counting frame with colorful beads!</p>
                
                <div class="character-speech">
                    <strong>ARIA:</strong> "Little X, before computers and calculators, scientists used THIS to count EVERYTHING‚Äîfrom stars in the sky to grains of rice to animals in the forest!"
                </div>
                
                <div class="character-speech">
                    <strong>Little X:</strong> "What is it?!"
                </div>
                
                <div class="character-speech">
                    <strong>ARIA:</strong> "It's called an ABACUS! For over 2,000 years, this was humanity's calculator! See the golden beads on top? Each one equals 5! The red beads on bottom? Each equals 1! When you slide beads toward the golden bar in the middle, you're COUNTING them!"
                </div>
                
                <div class="character-speech">
                    <strong>Raaarrr:</strong> "Raaarrr! So if I count 7 trees, I slide the top bead down (that's 5!) then slide 2 bottom beads up (that's 2 more!) = 7 trees total! RAAARRR-MATH!"
                </div>
                
                <div class="character-speech">
                    <strong>ARIA:</strong> "Exactly! And here's the AMAZING part‚Äîthis teaches you BASE-5 counting inside BASE-10 numbers! It's the SAME pattern that computers use, just with 0s and 1s instead of beads! Ancient wisdom meets future technology!"
                </div>
                
                <div class="character-speech">
                    <strong>Little X:</strong> "So when I count 23 birds, I use the Tens column for 2 beads (= 20) and the Ones column for 3 beads (= 3)! That's 23 birds!"
                </div>
                
                <p>ARIA beamed. "YES! Scientists need to COUNT and MEASURE everything‚Äîfrom pollution clouds to healthy trees to stars in galaxies! The abacus helps train your brain to think in patterns, just like nature does!"</p>
            </div>
            
            <div class="chalkboard-container">
                <h3>üßÆ Your Real Abacus Calculator!</h3>
                <p style="font-size: 0.95em; line-height: 1.6;">
                    <strong>Heaven Beads (gold, top):</strong> Worth 5 each. Click to slide DOWN to golden bar.<br>
                    <strong>Earth Beads (red, bottom):</strong> Worth 1 each. Click to slide UP to golden bar.<br>
                    <strong>Touching the golden bar = COUNTED!</strong>
                </p>
                
                <div class="abacus-frame">
                    <div style="display: flex; justify-content: space-around; margin-bottom: 15px;">
                        <div class="column-label">Hundreds</div>
                        <div class="column-label">Tens</div>
                        <div class="column-label">Ones</div>
                    </div>
                    
                    <div class="abacus-columns">
                        <!-- Hundreds Column -->
                        <div class="abacus-column" data-place="100">
                            <div class="heaven-section">
                                <div class="rod"></div>
                                <div class="bead heaven" data-value="500" onclick="toggleAbacusBead(this)">5</div>
                            </div>
                            <div class="divider-bar"></div>
                            <div class="earth-section">
                                <div class="rod"></div>
                                <div class="bead earth" data-value="100" onclick="toggleAbacusBead(this)">1</div>
                                <div class="bead earth" data-value="100" onclick="toggleAbacusBead(this)">1</div>
                                <div class="bead earth" data-value="100" onclick="toggleAbacusBead(this)">1</div>
                                <div class="bead earth" data-value="100" onclick="toggleAbacusBead(this)">1</div>
                            </div>
                        </div>

                        <!-- Tens Column -->
                        <div class="abacus-column" data-place="10">
                            <div class="heaven-section">
                                <div class="rod"></div>
                                <div class="bead heaven" data-value="50" onclick="toggleAbacusBead(this)">5</div>
                            </div>
                            <div class="divider-bar"></div>
                            <div class="earth-section">
                                <div class="rod"></div>
                                <div class="bead earth" data-value="10" onclick="toggleAbacusBead(this)">1</div>
                                <div class="bead earth" data-value="10" onclick="toggleAbacusBead(this)">1</div>
                                <div class="bead earth" data-value="10" onclick="toggleAbacusBead(this)">1</div>
                                <div class="bead earth" data-value="10" onclick="toggleAbacusBead(this)">1</div>
                            </div>
                        </div>

                        <!-- Ones Column -->
                        <div class="abacus-column" data-place="1">
                            <div class="heaven-section">
                                <div class="rod"></div>
                                <div class="bead heaven" data-value="5" onclick="toggleAbacusBead(this)">5</div>
                            </div>
                            <div class="divider-bar"></div>
                            <div class="earth-section">
                                <div class="rod"></div>
                                <div class="bead earth" data-value="1" onclick="toggleAbacusBead(this)">1</div>
                                <div class="bead earth" data-value="1" onclick="toggleAbacusBead(this)">1</div>
                                <div class="bead earth" data-value="1" onclick="toggleAbacusBead(this)">1</div>
                                <div class="bead earth" data-value="1" onclick="toggleAbacusBead(this)">1</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="abacus-display">
                    <div style="color: #00ff00; font-size: 1.1em; margin-bottom: 8px;">Your Count:</div>
                    <div class="abacus-total" id="abacusTotal">0</div>
                    <div class="abacus-breakdown">
                        <div class="breakdown-item">üíØ <span id="abacusHundreds">0</span></div>
                        <div class="breakdown-item">üîü <span id="abacusTens">0</span></div>
                        <div class="breakdown-item">1Ô∏è‚É£ <span id="abacusOnes">0</span></div>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn" onclick="resetAbacus()">üîÑ Reset Abacus</button>
                    <button class="btn" onclick="showAbacusExample(23)">üìö Show 23</button>
                    <button class="btn" onclick="showAbacusExample(55)">üìö Show 55</button>
                    <button class="btn" onclick="abacusChallenge()">üéØ Challenge Me!</button>
                </div>
                
                <div id="abacusMessage" style="margin-top: 15px; color: #00ff00; font-weight: bold; min-height: 30px;"></div>
            </div>
            
            <div class="character-speech">
                <strong>ARIA:</strong> "Now you can count ANYTHING in the web of life! How many trees need planting? How many animals to protect? How many pollution clouds to clean? The abacus trains your brain to see patterns EVERYWHERE! üß†‚ú®"
            </div>
        </div>

        <!-- Continue with rest of original chapters... -->
        <div class="chapter" id="chapter2" style="display: none;">
            <h2>Chapter 2: The Scientific Method</h2>
            <div class="story-text">
                <p>Continue with original Book 3 content...</p>
            </div>
        </div>

        <div class="nav-buttons">
            <button class="btn" onclick="loadChapter(1)">üåç Chapter 1</button>
            <button class="btn" onclick="loadChapter('abacus')">üßÆ Abacus Chapter</button>
            <button class="btn" onclick="loadChapter(2)">üî¨ Chapter 2</button>
        </div>
    </div>

    <script>
        // Stars background
        function createStars() {
            const container = document.getElementById('stars-container');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = star.style.height = Math.random() * 3 + 'px';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(star);
            }
        }

        // Audio
        let audioContext = null;
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        function playTone(freq, duration, type = 'sine') {
            if (!audioContext) return;
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.frequency.value = freq;
            osc.type = type;
            gain.gain.setValueAtTime(0.3, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            osc.start();
            osc.stop(audioContext.currentTime + duration);
        }

        // Web canvas (original functionality)
        let webCanvas, webCtx;
        let webNodes = [];
        let webLines = [];
        let drawing = false;
        let startNode = null;
        let pollutionClouds = [];
        let zapMode = false;

        function setupWebCanvas() {
            webCanvas = document.getElementById('web-canvas');
            if (!webCanvas) return;
            webCtx = webCanvas.getContext('2d');
            webNodes = [
                { x: 300, y: 50, emoji: '‚òÄÔ∏è', label: 'Sun', type: 'sun' },
                { x: 150, y: 150, emoji: 'üå±', label: 'Plant', type: 'plant' },
                { x: 450, y: 150, emoji: 'üêõ', label: 'Bug', type: 'bug' },
                { x: 150, y: 300, emoji: 'üê¶', label: 'Bird', type: 'bird' },
                { x: 450, y: 300, emoji: 'üå∏', label: 'Flower', type: 'flower' }
            ];
            pollutionClouds = [
                { x: 100, y: 200, size: 30, active: true },
                { x: 500, y: 250, size: 25, active: true },
                { x: 300, y: 350, size: 28, active: true }
            ];
            webCanvas.addEventListener('mousedown', startDrawing);
            webCanvas.addEventListener('mousemove', drawLine);
            webCanvas.addEventListener('mouseup', finishDrawing);
            drawEcosystem();
        }

        function drawEcosystem() {
            if (!webCtx) return;
            webCtx.clearRect(0, 0, webCanvas.width, webCanvas.height);
            webCtx.fillStyle = 'rgba(0, 50, 0, 0.3)';
            webCtx.fillRect(0, 0, webCanvas.width, webCanvas.height);
            
            webLines.forEach(line => {
                webCtx.strokeStyle = '#00ff00';
                webCtx.lineWidth = 3;
                webCtx.beginPath();
                webCtx.moveTo(line.from.x, line.from.y);
                webCtx.lineTo(line.to.x, line.to.y);
                webCtx.stroke();
            });
            
            pollutionClouds.forEach(cloud => {
                if (cloud.active) {
                    webCtx.fillStyle = 'rgba(100, 100, 100, 0.6)';
                    webCtx.beginPath();
                    webCtx.arc(cloud.x, cloud.y, cloud.size, 0, Math.PI * 2);
                    webCtx.fill();
                    webCtx.fillStyle = 'white';
                    webCtx.font = '20px Arial';
                    webCtx.textAlign = 'center';
                    webCtx.fillText('‚òÅÔ∏è', cloud.x, cloud.y + 7);
                }
            });
            
            webNodes.forEach(node => {
                webCtx.fillStyle = 'white';
                webCtx.font = '40px Arial';
                webCtx.textAlign = 'center';
                webCtx.fillText(node.emoji, node.x, node.y + 12);
                webCtx.font = '14px Arial';
                webCtx.fillText(node.label, node.x, node.y + 35);
            });
        }

        function startDrawing(e) {
            if (zapMode) return zapPollution(e);
            const rect = webCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            startNode = webNodes.find(n => Math.sqrt((x - n.x) ** 2 + (y - n.y) ** 2) < 30);
            drawing = !!startNode;
        }

        function drawLine(e) {
            if (!drawing) return;
            const rect = webCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            drawEcosystem();
            webCtx.strokeStyle = '#00ff00';
            webCtx.setLineDash([5, 5]);
            webCtx.lineWidth = 2;
            webCtx.beginPath();
            webCtx.moveTo(startNode.x, startNode.y);
            webCtx.lineTo(x, y);
            webCtx.stroke();
            webCtx.setLineDash([]);
        }

        function finishDrawing(e) {
            if (!drawing) return;
            const rect = webCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const endNode = webNodes.find(n => Math.sqrt((x - n.x) ** 2 + (y - n.y) ** 2) < 30);
            if (endNode && endNode !== startNode) {
                webLines.push({ from: startNode, to: endNode });
                initAudio();
                playTone(523, 0.2, 'sine');
            }
            drawing = false;
            startNode = null;
            drawEcosystem();
        }

        function clearWeb() {
            webLines = [];
            drawEcosystem();
            document.getElementById('web-message').textContent = 'Canvas cleared! Draw new connections!';
        }

        function startCleanup() {
            zapMode = true;
            document.getElementById('web-message').textContent = 'üßπ Click pollution clouds to ZAP them!';
            initAudio();
            playTone(659, 0.3, 'sine');
        }

        function zapPollution(e) {
            const rect = webCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            let zapped = false;
            pollutionClouds.forEach(cloud => {
                if (cloud.active) {
                    const dist = Math.sqrt((x - cloud.x) ** 2 + (y - cloud.y) ** 2);
                    if (dist < cloud.size) {
                        cloud.active = false;
                        zapped = true;
                        for (let i = 0; i < 5; i++) {
                            setTimeout(() => {
                                const sparkle = document.createElement('div');
                                sparkle.textContent = '‚ú®';
                                sparkle.style.cssText = `position: absolute; font-size: 24px; color: #00ff00; 
                                    left: ${rect.left + cloud.x}px; top: ${rect.top + cloud.y}px; 
                                    animation: float-up 1s ease-out forwards; pointer-events: none; z-index: 100;`;
                                document.body.appendChild(sparkle);
                                setTimeout(() => sparkle.remove(), 1000);
                            }, i * 100);
                        }
                        initAudio();
                        playTone(880, 0.3, 'sine');
                    }
                }
            });
            if (zapped) {
                const remaining = pollutionClouds.filter(c => c.active).length;
                if (remaining === 0) {
                    document.getElementById('web-message').textContent = 'üåü ALL CLEAN! Science wins! üåü';
                    zapMode = false;
                } else {
                    document.getElementById('web-message').textContent = `ZAP! ${remaining} cloud${remaining > 1 ? 's' : ''} left!`;
                }
            }
            drawEcosystem();
        }

        function checkWeb() {
            const connections = webLines.length;
            const message = document.getElementById('web-message');
            if (connections >= 4) {
                message.textContent = 'üåü Amazing web! Try Pollution Zap! üåü';
                initAudio();
                playTone(523, 0.4, 'sine');
            } else if (connections > 0) {
                message.textContent = `Good! ${connections} connection${connections > 1 ? 's' : ''}.`;
            } else {
                message.textContent = 'Draw some lines first!';
            }
        }

        // ABACUS FUNCTIONS
        function toggleAbacusBead(bead) {
            bead.classList.toggle('counted');
            initAudio();
            playTone(bead.classList.contains('counted') ? 440 : 340, 0.1, 'sine');
            updateAbacusDisplay();
        }

        function updateAbacusDisplay() {
            let hundreds = 0, tens = 0, ones = 0;
            
            document.querySelectorAll('[data-place="100"] .bead.counted').forEach(b => {
                hundreds += parseInt(b.dataset.value);
            });
            document.querySelectorAll('[data-place="10"] .bead.counted').forEach(b => {
                tens += parseInt(b.dataset.value);
            });
            document.querySelectorAll('[data-place="1"] .bead.counted').forEach(b => {
                ones += parseInt(b.dataset.value);
            });
            
            const total = hundreds + tens + ones;
            document.getElementById('abacusTotal').textContent = total;
            document.getElementById('abacusHundreds').textContent = hundreds;
            document.getElementById('abacusTens').textContent = tens;
            document.getElementById('abacusOnes').textContent = ones;
        }

        function resetAbacus() {
            document.querySelectorAll('.bead').forEach(b => b.classList.remove('counted'));
            updateAbacusDisplay();
            document.getElementById('abacusMessage').textContent = 'üîÑ Reset! Ready to count again!';
        }

        function showAbacusExample(num) {
            resetAbacus();
            const msg = document.getElementById('abacusMessage');
            msg.textContent = `üìö Watch how we make ${num}...`;
            
            setTimeout(() => {
                if (num === 23) {
                    const tensBeads = document.querySelectorAll('[data-place="10"] .earth');
                    tensBeads[0].classList.add('counted');
                    playTone(440, 0.1, 'sine');
                    updateAbacusDisplay();
                    setTimeout(() => {
                        tensBeads[1].classList.add('counted');
                        playTone(440, 0.1, 'sine');
                        updateAbacusDisplay();
                        setTimeout(() => {
                            const onesBeads = document.querySelectorAll('[data-place="1"] .earth');
                            onesBeads[0].classList.add('counted');
                            playTone(440, 0.1, 'sine');
                            updateAbacusDisplay();
                            setTimeout(() => {
                                onesBeads[1].classList.add('counted');
                                playTone(440, 0.1, 'sine');
                                updateAbacusDisplay();
                                setTimeout(() => {
                                    onesBeads[2].classList.add('counted');
                                    playTone(440, 0.1, 'sine');
                                    updateAbacusDisplay();
                                    msg.textContent = '‚ú® That\'s 23! 2 tens + 3 ones!';
                                }, 300);
                            }, 300);
                        }, 300);
                    }, 300);
                } else if (num === 55) {
                    const tensHeaven = document.querySelector('[data-place="10"] .heaven');
                    tensHeaven.classList.add('counted');
                    playTone(440, 0.1, 'sine');
                    updateAbacusDisplay();
                    setTimeout(() => {
                        const onesHeaven = document.querySelector('[data-place="1"] .heaven');
                        onesHeaven.classList.add('counted');
                        playTone(440, 0.1, 'sine');
                        updateAbacusDisplay();
                        msg.textContent = '‚ú® That\'s 55! Heaven beads are powerful!';
                    }, 400);
                }
            }, 500);
        }

        let currentChallenge = null;
        function abacusChallenge() {
            const challenges = [7, 12, 23, 48, 55, 99];
            currentChallenge = challenges[Math.floor(Math.random() * challenges.length)];
            resetAbacus();
            document.getElementById('abacusMessage').textContent = `üéØ Can you make ${currentChallenge}? Try it!`;
            
            // Auto-check
            const checkInterval = setInterval(() => {
                const total = parseInt(document.getElementById('abacusTotal').textContent);
                if (total === currentChallenge) {
                    clearInterval(checkInterval);
                    document.getElementById('abacusMessage').textContent = 'üéâ PERFECT! You did it! üåü';
                    initAudio();
                    playTone(659, 0.3, 'sine');
                    setTimeout(() => playTone(784, 0.3, 'sine'), 200);
                    currentChallenge = null;
                }
            }, 500);
        }

        function loadChapter(num) {
            document.querySelectorAll('.chapter').forEach(ch => ch.style.display = 'none');
            if (num === 1) {
                document.querySelector('.chapter').style.display = 'block';
                setTimeout(setupWebCanvas, 100);
            } else if (num === 'abacus') {
                document.getElementById('chapter-abacus').style.display = 'block';
            } else if (num === 2) {
                document.getElementById('chapter2').style.display = 'block';
            }
            window.scrollTo(0, 0);
        }

        window.addEventListener('DOMContentLoaded', () => {
            createStars();
            setupWebCanvas();
        });
    </script>
        loadProgress();
            console.log('Little X Book 2 - Complete & Ready! üñçÔ∏èü¶ñ‚ú®');
        });
    </script>
    <!-- Audio Narration System -->
    <script src="https://coldnsteel.github.io/GMSRFC/little-x-audio-narration.js"></script>
</body>
</html>

</body>
</html>
